"""
Sanity-диапазоны для известных лабораторных показателей.
Используются для фильтрации очевидного OCR-мусора.

Диапазоны НАМЕРЕННО ШИРОКИЕ — мы отсекаем только абсолютную чепуху,
а не редкие клинические случаи.
"""

# Словарь: canonical_name → (min_possible, max_possible)
# Значения вне диапазона считаются OCR-мусором и отбрасываются.
SANITY_RANGES: dict[str, tuple[float, float]] = {
    "WBC":  (0.1,   200.0),   # *10^9/л, реальные: 0.1–100, мусор: 8500
    "RBC":  (0.5,   15.0),    # *10^12/л
    "HGB":  (10.0,  300.0),   # г/л
    "HCT":  (5.0,   70.0),    # %
    "PLT":  (1.0,   3000.0),  # *10^9/л
    "ALT":  (0.1,   10000.0), # Ед/л, экстремальные гепатиты до 5000+
    "AST":  (0.1,   10000.0), # Ед/л
    "GLU":  (0.5,   100.0),   # ммоль/л
    "CRP":  (0.0,   5000.0),  # мг/л, при сепсисе >300
    "CREA": (10.0,  5000.0),  # мкмоль/л, при тяжёлой ХПН до 2000+
}


def is_sanity_outlier(canonical_name: str, value: float) -> bool:
    """
    Возвращает True, если значение value для показателя canonical_name
    является очевидным OCR-мусором (выходит за широкие sanity-границы).

    Для НЕИЗВЕСТНЫХ canonical_name всегда возвращает False.
    """
    if canonical_name not in SANITY_RANGES:
        return False
    lo, hi = SANITY_RANGES[canonical_name]
    return not (lo <= value <= hi)

